{% extends "base.html" %}
{% block content %}
    <div id="game">
        <canvas id="myCanvas" width="1000" height="700" style="border:1px solid black;">
        </canvas>
    </div>
    <script>
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");
        var items = [];
        var mousepos;

        function item(x, y, w, h, vector, creator) {
            this.x = x;
            this.y = y;
            this.width = w;
            this.height = h;
            this.vector = vector;
            this.creator = function() {creator(this.x, this.y, this.width, this.height)};
            items.push(this);
        };

        function drawGame() {
            updatePhysics();
            updatePaddle();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (i=0;i<items.length;i++) {
                items[i].creator()
            };
            setTimeout(drawGame, 5);
        };

        function updatePhysics() {
            for (i=0;i<items.length;i++) {
                var vector = items[i].vector;
                items[i].x = items[i].x + vector[0];
                items[i].y = items[i].y + vector[1];
                checkCollision(items[i]);
            };
        };

        function updatePaddle() {
            paddle.x = mousepos? mousepos.x - (paddle.width/2) : paddle.x
        };

        function checkCollision(obj) {
            if (obj.x <= 0) {obj.vector = [Math.abs(obj.vector[0]), obj.vector[1]];};
            if (obj.y <= 0) {obj.vector = [obj.vector[0], Math.abs(obj.vector[1])]};
            if (obj.y + obj.height >= canvas.height) {obj.vector = [obj.vector[0], -obj.vector[1]]};
            if (obj.x + obj.width >= canvas.width) {obj.vector = [-obj.vector[0], obj.vector[1]]};
        };

        function getPosition(e) {

            //this section is from http://www.quirksmode.org/js/events_properties.html
            var targ;
            if (!e)
                e = window.event;
            if (e.target)
                targ = e.target;
            else if (e.srcElement)
                targ = e.srcElement;
            if (targ.nodeType == 3) // defeat Safari bug
                targ = targ.parentNode;

            // jQuery normalizes the pageX and pageY
            // pageX,Y are the mouse positions relative to the document
            // offset() returns the position of the element relative to the document
            var x = e.pageX - $(targ).offset().left;
            var y = e.pageY - $(targ).offset().top;

            return {"x": x, "y": y};
        };
        // now just make sure you use this with jQuery
        // obviously you can use other events other than click
        $(myCanvas).mousemove(function(event) {
            // jQuery would normalize the event
            mousepos = getPosition(event);
        });

        var redRect = function(x, y, w, h) {
            ctx.fillStyle = "red";
            ctx.fillRect(x, y, w, h);
        };

        var blueRect = function(x, y, w, h) {
            ctx.fillStyle = "blue";
            ctx.fillRect(x, y, w, h);
        };

        var yellowBall = function(x, y, w, h) {
            ctx.beginPath();
            ctx.fillStyle = "yellow";
            ctx.arc(x, y, w, 0, 2 * Math.PI);
            ctx.fill()
        };

        for (i=1;i<21;i++) {
            var block = new item(50 + (i * 41), 50, 40, 20, [0, 0], redRect);
        };

        var paddle = new item(400, 600, 100, 30, [0, 0], blueRect);

        var ball = new item(200, 400, 20, 5, [0.5, 0.5], yellowBall);

        drawGame();
    </script>
{% endblock %}